---
title: "Metody nieparametryczne w statystyce"
subtitle: "Zestaw 1, zadanie 6"
author: "Jakub Kozub"
date: "2024-05-20"
output:
  html_document:
    toc: yes
    toc_float: yes
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```


## Wstp

Celem badania jest por贸wnanie mocy test贸w Komogorowa, Lillieforsa i Andersona-Darlinga w przypadku, gdy dane pochodz z rozkadu -Studenta. Dodatkowo, brany pod uwag jest te偶 wpyw na moc testu takich czynnik贸w, jak:

* liczba danych,

* liczba stopni swobody generowanego rozkadu t-Studenta.


H0: cecha ma rozkad normalny

H1: cecha nie ma rozkadu normalnego

Poniewa偶 dane w badaniu bd pochodziy z rozkadu -Studenta, wiemy z g贸ry, 偶e hipoteza zerowa bdzie dla tych danych faszywa. Wyznaczenie mocy testu bdzie zatem r贸wnowa偶ne z wyznaczeniem odsetka odrzuce H0.

## Przygotowania

```{r}
library(ggplot2)
library(dplyr)
library(nortest)
library(tseries)
```

Po zaadowaniu odpowiednich pakiet贸w, rozpoczynam przygotowanie do badania od utworzenia funkcji su偶cych do wyznaczania mocy poszczeg贸lnych test贸w dla zadanych wartoci argument贸w:

* `n` - liczba danych,

* `dof` - liczba stopni swobody generowanego rozkadu t-Studenta,

* `alfa` - poziom istotnoci przyjty dla testu,

* `k` - liczba powt贸rze.

Funkcje te `k` razy generuj wektor `n` danych z rozkadu t-Studenta o `dof` stopniach swobody, standaryzuj go i wykonuj na nim odpowiedni test zgodnoci z rozkadem normalnym. Jeli uzyskane p-value jest mniejsze od poziomu istotnoci `alfa`, to funkcja wykonywana na wektorze 1:k zwraca warto `TRUE`. Rezultatem dziaania funkcji `sapply` jest wic wektor wartoci logicznych o dugoci `k`. Obliczana na koniec rednia wartoci tego wektora jest r贸wna odsetkowi odrzuce H0 w badanym tecie.

```{r}

mocKolmogorow <- function(n, dof, alfa, k) {
  mean(
    sapply(1:k,
           function(i) {
             x <- rt(n, dof)
             u <- (x-mean(x))/sd(x)
             ks.test(u, "pnorm")$p.value < alfa
           }
    )
  )
}

mocLilliefors <- function(n, dof, alfa, k) {
  mean(
    sapply(1:k,
           function(i) {
             x <- rt(n, dof)
             u <- (x-mean(x))/sd(x)
             lillie.test(u)$p.value < alfa
           }
    )
  )
}

mocAnderson <- function(n, dof, alfa, k) {
  mean(
    sapply(1:k,
           function(i) {
             x <- rt(n, dof)
             u <- (x-mean(x))/sd(x)
             ad.test(u)$p.value < alfa
           }
    )
  )
}
```

Tworz zmienne przechowujce ustalone z g贸ry wartoci alfa i k oraz wektory wartoci n i dof. Ustawiam te偶 ziarno generatora, by wyniki nie zmieniay si przy ka偶dym uruchomieniu.

```{r}
alfa <- 0.05
k <- 1000

n_vec <- c(10, 20, 50, 100, 200, 500, 1000)
dof_vec <- 1:20

set.seed(123)
```


## Badanie

### Wyznaczenie mocy test贸w

Wyznaczam moce badanych test贸w dla wszystkich kombinacji wartoci n i dof z utworzonych powy偶ej wektor贸w i zapisuj wyniki w ramce danych.

```{r}
lapply(n_vec, function(n){
  data.frame(
    dof=dof_vec,
    n=n,
    powKS=sapply( dof_vec, function(dof) {
      mocKolmogorow(n, dof, alfa, k)
    }),
    powL=sapply( dof_vec, function(dof) {
      mocLilliefors(n, dof, alfa, k)
    }),
    powAD=sapply( dof_vec, function(dof) {
      mocAnderson(n, dof, alfa, k)
    })
  )
}) %>% 
  do.call(what=rbind) -> testy_df
```


### Wykresy mocy test贸w w zale偶noci od n i dof

Dla ka偶dego z badanych rozkad贸w przedstawiam na wykresie krzywe mocy testu w zale偶noci od liczby stopni swobody generowanego rozkadu dla 

```{r}
testy_df %>%
  ggplot(aes(x=dof, y=powKS, col=factor(n)))+
  geom_line() +
  geom_hline(yintercept = 0.05, lty=2, col="blue") +
  labs(title="Test Kolmogorowa-Smirnowa", x="Liczba stopni swobody", y="Moc testu", col="Liczba danych")

```


```{r, echo=FALSE}
testy_df %>%
  ggplot(aes(x=dof, y=powL, col=factor(n)))+
  geom_line() +
  geom_hline(yintercept = 0.05, lty=2, col="blue") +
  labs(title="Test Lillieforsa", x="Liczba stopni swobody", y="Moc testu", col="Liczba danych")

testy_df %>%
  ggplot(aes(x=dof, y=powAD, col=factor(n)))+
  geom_line() +
  geom_hline(yintercept = 0.05, lty=2, col="blue") +
  labs(title="Test Andersona-Darlinga", x="Liczba stopni swobody", y="Moc testu", col="Liczba danych")

```


### Moc badanych test贸w w zale偶noci od liczby stopni swobody rozkadu

Dla wybranych wartoci `n` bezporednio por贸wnuj badane testy pod wzgldem zale偶noci mocy testu od liczby stopni swobody generowanego rozkadu.

```{r}
for (ni in c(20, 100, 500)) {
  plot(x=dof_vec, y=testy_df[testy_df$n==ni,"powKS"], type = "l", col="green",
       main=paste("Moc badanych test贸w w zale偶noci", "\n", "od liczby stopni swobody rozkadu dla n =", ni),
       xlab="Liczba stopni swobody", ylab="Moc testu")
  lines(testy_df[testy_df$n==ni,"powL"], col = "blue")
  lines(testy_df[testy_df$n==ni,"powAD"], col = "red")
  legend(x = "topright", 
         legend=c("Test Kolmogorowa-Smirnowa", "Test Lillieforsa", "Test Andersona-Darlinga"),  
         col = c("green", "blue", "red"),
         lty=rep(1, 3), box.lty=1
  ) 
}
```


## Podsumowanie

Na podstawie utworzonych wykres贸w mo偶na stwierdzi, 偶e dla wszystkich badanych test贸w ich moc zdaje si rosn wraz ze wzrostem liczby danych. Maleje ona natomiast wraz ze wzrostem liczby stopni swobody generowanego rozkadu, co zapewne wynika z rosncego wraz z liczb stopni swobody podobiestwa rozkadu t-studenta do rozkadu normalnego. Sprawia to, 偶e im wy偶sza liczba stopni swobody, tym trudniej odr贸偶ni rozkad t-Studenta od rozkadu normalnego, czyli odrzuci hipotez zerow w tecie normalnoci. Na podstawie wykres贸w mo偶emy jednak oceni "odporno" badanych test贸w na ten problem, por贸wnujc ich moce. Por贸wnanie takie sugeruje, 偶e uszeregowanie ich od najwikszej do najmniejszej mocy mo偶e wyglda nastpujco:

1. test Andersona-Darlinga,

2. test Lillieforsa,

3. test Komogorowa.

Warto jednak odnotowa, 偶e o ile dwa pierwsze testy osigny dosy zbli偶one wyniki, tak test Komogorowa znacznie od nich odstaje i wydaje si by zdecydowanie sabszy.
